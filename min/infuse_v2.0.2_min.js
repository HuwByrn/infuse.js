/* infuse.js - v2.0.2 - 2016-09-07 - https://github.com/soundstep/infuse.js - http://www.soundstep.com */!function(a){"use strict";function b(a,b){for(var c=a.length;c--;)if(a[c]===b)return!0;return!1}a.version="2.0.2";var c=/^function\s*[^\(]*\(\s*([^\)]*)\)/m,d=/(?!function)\s*constructor\s*[^\(|function]*\(\s*([^\)]*)\)\s*{/m,e=/,/,f=/^\s*(_?)(\S+?)\1\s*$/,g=/((\/\/.*$)|(\/\*[\s\S]*?\*\/))/gm;a.errors={MAPPING_BAD_PROP:"[Error infuse.Injector.mapClass/mapValue] The first parameter is invalid, a string is expected.",MAPPING_BAD_VALUE:"[Error infuse.Injector.mapClass/mapValue] The second parameter is invalid, it can't null or undefined, with property: ",MAPPING_BAD_CLASS:"[Error infuse.Injector.mapClass/mapValue] The second parameter is invalid, a function is expected, with property: ",MAPPING_BAD_SINGLETON:"[Error infuse.Injector.mapClass] The third parameter is invalid, a boolean is expected, with property: ",MAPPING_ALREADY_EXISTS:"[Error infuse.Injector.mapClass/mapValue] This mapping already exists, with property: ",CREATE_INSTANCE_INVALID_PARAM:"[Error infuse.Injector.createInstance] Invalid parameter, a function is expected.",NO_MAPPING_FOUND:"[Error infuse.Injector.getInstance] No mapping found.",INJECT_INSTANCE_IN_ITSELF_PROPERTY:"[Error infuse.Injector.getInjectedValue] A matching property has been found in the target, you can't inject an instance in itself.",INJECT_INSTANCE_IN_ITSELF_CONSTRUCTOR:"[Error infuse.Injector.getInjectedValue] A matching constructor parameter has been found in the target, you can't inject an instance in itself.",DEPENDENCIES_MISSING_IN_STRICT_MODE:'[Error infuse.Injector.getDependencies] An "inject" property (array) that describes the dependencies is missing in strict mode.',DEPENDENCIES_INVALID_TARGET:"[Error infuse.Injector.getDependencies] Invalid target, a function or a class is expected (arrow function cannot be instantiated)."};var h=function(a,b,c,d){this.prop=a,this.value=b,this.cl=c,this.singleton=d||!1},i=function(b){if("string"!=typeof b)throw new Error(a.errors.MAPPING_BAD_PROP)},j=function(b,c){if(void 0===c||null===c)throw new Error(a.errors.MAPPING_BAD_VALUE+b)},k=function(b,c){if("function"!=typeof c)throw new Error(a.errors.MAPPING_BAD_CLASS+b)},l=function(b,c){if("boolean"!=typeof c)throw new Error(a.errors.MAPPING_BAD_SINGLETON+b)},m=function(c,d){var e=a.getDependencies(d);if(b(e,c))throw new Error(a.errors.INJECT_INSTANCE_IN_ITSELF_CONSTRUCTOR)},n=function(b,c){if(c.hasOwnProperty(b))throw new Error(a.errors.INJECT_INSTANCE_IN_ITSELF_PROPERTY)};a.Injector=function(){this.mappings={},this.parent=null,this.strictMode=!1,this.throwOnMissing=!0},a.getDependencies=function(b){function h(a,b,c){j.push(c)}var i,j=[];b.hasOwnProperty("inject")&&"[object Array]"===Object.prototype.toString.call(b.inject)&&b.inject.length>0&&(i=b.inject);var k,l=b.toString().replace(g,"");if(0===l.indexOf("class"))k=l.replace(/function constructor/g,"").match(d);else{if(0!==l.indexOf("function"))throw new Error(a.errors.DEPENDENCIES_INVALID_TARGET);k=l.match(c)}if(k)for(var m=k[1].split(e),n=0,o=m.length;o>n;n++){var p=m[n].split("=")[0].replace(/\s/g,""),q=i&&i[n]?i[n]:p;q.replace(f,h)}return j},a.Injector.prototype={createChild:function(){var b=new a.Injector;return b.parent=this,b.strictMode=this.strictMode,b.throwOnMissing=this.throwOnMissing,b},getMappingVo:function(a){return this.mappings?this.mappings[a]?this.mappings[a]:this.parent?this.parent.getMappingVo(a):null:null},mapValue:function(b,c){if(this.mappings[b])throw new Error(a.errors.MAPPING_ALREADY_EXISTS+b);return i(b),j(b,c),this.mappings[b]=new h(b,c,void 0,void 0),this},mapClass:function(b,c,d){if(this.mappings[b])throw new Error(a.errors.MAPPING_ALREADY_EXISTS+b);return i(b),k(b,c),d&&l(b,d),this.mappings[b]=new h(b,null,c,d),this},removeMapping:function(a){return this.mappings[a]=null,delete this.mappings[a],this},hasMapping:function(a){return!!this.mappings[a]},hasInheritedMapping:function(a){return!!this.getMappingVo(a)},getMapping:function(a){for(var b in this.mappings)if(this.mappings.hasOwnProperty(b)){var c=this.mappings[b];if(c.value===a||c.cl===a)return c.prop}return void 0},getValue:function(b){var c=this.mappings[b];if(!c){if(!this.parent)throw new Error(a.errors.NO_MAPPING_FOUND);c=this.parent.getMappingVo.apply(this.parent,arguments)}if(c.cl){var d=Array.prototype.slice.call(arguments);return d[0]=c.cl,c.singleton?(c.value||(c.value=this.createInstance.apply(this,d)),c.value):this.createInstance.apply(this,d)}return c.value},getClass:function(a){var b=this.mappings[a];if(!b){if(!this.parent)return void 0;b=this.parent.getMappingVo.apply(this.parent,arguments)}return b.cl?b.cl:void 0},instantiate:function(b){if("function"!=typeof b)throw new Error(a.errors.CREATE_INSTANCE_INVALID_PARAM);if(this.strictMode&&!b.hasOwnProperty("inject"))throw new Error(a.errors.DEPENDENCIES_MISSING_IN_STRICT_MODE);for(var c=[null],d=a.getDependencies(b),e=0,f=d.length;f>e;e++)if(arguments.length>e+1&&void 0!==arguments[e+1]&&null!==arguments[e+1])c.push(arguments[e+1]);else{var g=d[e],h=this.getMappingVo(g);if(h){var i=this.getInjectedValue(h,g);c.push(i)}else{if(this.throwOnMissing)throw new Error(a.errors.NO_MAPPING_FOUND+' for dependency "'+g+'" when instantiating "'+b.name+'"');c.push(void 0)}}return new(Function.prototype.bind.apply(b,c))},inject:function(a,b){this.parent&&this.parent.inject(a,!0);for(var c in this.mappings)if(this.mappings.hasOwnProperty(c)){var d=this.getMappingVo(c);(a.hasOwnProperty(d.prop)||a.constructor&&a.constructor.prototype&&a.constructor.prototype.hasOwnProperty(d.prop))&&(a[c]=this.getInjectedValue(d,c))}return"function"!=typeof a.postConstruct||b||a.postConstruct(),this},getInjectedValue:function(a,b){var c,d=a.value;return a.cl&&(a.singleton?(a.value||(m(b,a.cl),a.value=this.instantiate(a.cl),c=a.value),d=a.value):(m(b,a.cl),d=this.instantiate(a.cl),c=d)),c&&(n(b,c),this.inject(c)),d},createInstance:function(){var a=this.instantiate.apply(this,arguments);return this.inject(a),a},getValueFromClass:function(b){for(var c in this.mappings)if(this.mappings.hasOwnProperty(c)){var d=this.mappings[c];if(d.cl===b)return d.singleton?(d.value||(d.value=this.createInstance.apply(this,arguments)),d.value):this.createInstance.apply(this,arguments)}if(this.parent)return this.parent.getValueFromClass.apply(this.parent,arguments);throw new Error(a.errors.NO_MAPPING_FOUND)},dispose:function(){this.mappings={}}},Function.prototype.bind||(Function.prototype.bind=function(a){var b=this;if("function"!=typeof b)throw new Error("Error, you must bind a function.");var c=Array.prototype.slice.call(arguments,1),d=function(){if(this instanceof d){var e=function(){};e.prototype=b.prototype;var f=new e,g=b.apply(f,c.concat(Array.prototype.slice.call(arguments)));return Object(g)===g?g:f}return b.apply(a,c.concat(Array.prototype.slice.call(arguments)))};return d}),"function"==typeof define&&"undefined"!=typeof define.amd&&define("infuse",a),"undefined"!=typeof module&&"undefined"!=typeof module.exports&&(module.exports=a),"undefined"!=typeof exports&&(exports=a)}(this.infuse=this.infuse||{});